var fn_addin=function(s,e,t){var i=i||{};i.styles=i.styles||{},i.commands=i.commands||{},i.dependencies=t||i.dependencies||{},i.styles.style=function(){},i.views=i.views||{},i.collect=i.collect||{},i.models=i.models||{},i.templates=i.templates||{},i.info={widget:!0,placeholderType:"metric",id:"team_metric",class:"app-container base-metric metric",region:"top-right",order:"append",addin:"34fa06be-54ed-41d5-b1d9-5abed82fab39",visibleSetting:"teamMetricVisible",requiredFeature:"team_metric",dependencies:["base_metric"]},s.console.log(s.elapsed()+": "+i.info.id+" started"),i.collect.TeamMetrics=s.collect.SyncedCollection.extend({initialize:function(e,t){(t=t||{}).name="metrics/team",t.sorted=!0,t.transientProps=["random","selected"],t.model=i.models.TeamMetric,t.readOnly=!0,s.collect.SyncedCollection.prototype.initialize.call(this,e,t)},findPinned:function(){return this.filter(function(e){return!e.get("deleted")&&!e.get("archived")&&e.get("pinned")})},activeItems:function(){var e=this.models.filter(function(e){return!e.get("deleted")}),t=e;try{t=e.sort(function(e,t){return e.get("utcDate")-t.get("utcDate")})}catch(e){}return t},supportAddNew:function(){var e=s.models.teamInfo.get("team");return e&&e.userIsAdmin},supportEditTeamWidgets:function(){var e=s.models.teamInfo.get("team");return e&&e.userIsAdmin}}),i.models.TeamMetric=Backbone.Model.extend({placeholder:"Metric",nowString:"Now",todayString:"Today",defaults:function(){return{name:"",pinned:!1,utcDate:s.now(),hasHours:!1,past:!1,deleted:!1,archived:!1,serverSetId:!1,selected:!1,random:!1}},initialize:function(e){e=e||{},this.idAttribute=this.collection.idAttribute||"csid",Backbone.Model.prototype.initialize.call(this,e)},mainContent:function(){var e={};return e.name=this.get("name"),e.utcDate=this.get("utcDate"),e},getNameOrPlaceholder:function(){return this.get("label")||this.placeholder},getDetailViewVariables:function(){return{years:this.years,placeholder:this.placeholder}},getViewData:function(){this.formatTime();var e=s.date().getFullYear();this.lastSelectedYear=e,this.years=[];for(var t=e;t<e+5;t++)this.years.push(t);return{id:this.get("id"),pinned:this.get("pinned"),date:new Date(this.get("utcDate")),tooltip:this.generateDateTooltip(),metricType:"Metric",time:this.get("value"),unit:"",nameOrPlaceholder:this.getNameOrPlaceholder(),placeholder:this.placeholder,years:this.years,archived:this.get("archived"),random:!1}},generateDateTooltip:function(){var e=new Date(this.get("utcDate")),t=s.utils.getFriendlyDate(e);return this.get("hasHours")&&(t+=" "+s.utils.getHoursMinsStr(e)),t},formatTime:function(){var e,t=s.date(),i=new Date(this.get("utcDate")),n=this.calculateTimeLeft(t,i),a=this.get("hasHours"),r="";return n.past!==this.get("past")&&this.save("past",n.past,{silent:!0}),r=a&&n.minsTot<mConst("dateMinsPerHour")?(e=0===n.minsTot?this.nowString:n.minsTot,"m"):a&&n.hoursTot<mConst("dateHoursPerDay")?(e=n.hoursTot,"h"):(e=a||0!==n.nights?n.nights:this.todayString,"d"),n.past&&(r+=" ago"),e!==this.nowString&&e!==this.todayString||(r=""),{number:e,unit:r,timeData:n}},calculateTimeLeft:function(e,t){var i=(t-e)/mConst("dateMsPerMin"),n=i/mConst("dateMinsPerHour"),a=s.utils.nightsBetween(e,t,mConst("dateRolloverHour")),r=i<0;return{nights:Math.abs(a),hoursTot:Math.abs(Math.round(n)),minsTot:Math.abs(Math.round(i)),past:r}},editDetailOverride:function(){s.commandManager.execute("window.open",null,{url:"http://team.momentumdash.com/team/metrics?id="+this.get("id")})},allowPin:function(){return!1},allowEdit:function(){var e=s.models.teamInfo.get("team");return e&&e.userIsAdmin},togglePinned:function(){this.save("pinned",!this.get("pinned"))},toggleArchive:function(){this.save("archived",!this.get("archived"))},delete:function(){this.save("deleted",!0)}}),i.models.TeamMetricManager=Backbone.Model.extend({initialize:function(){i.collect.teamMetrics=this.collection=new i.collect.TeamMetrics,this.collection.fetch({reset:!0})}}),s.commandManager&&s.commandManager.registerCommand("team.metric.add",function(e){s.commandManager.execute("window.open",null,{url:"http://team.momentumdash.com/team/metrics?add"})});var n=i.dependencies.base_metric;return n.info=i.info,i.models.teamMetricManager=new i.models.TeamMetricManager,i.styles.style(),i.views.metric=s.widgetManager.handover("team_metric",n.views.BaseMetric,{model:i.models.TeamMetric,region:"top-right",order:"append",metricType:"TeamMetric",metricTitle:"Metrics",metricIcon:"icon-metric.svg",visibleSetting:"teamMetricVisible",defaultShowRandomState:!0,hideIfEmpty:!0,disableArchive:!0,addOverrideCommand:"team.metric.add",metricDescription:"Show misc metrics",manager:i.models.teamMetricManager}),s.widgets.push(i.views.metric),i};m.addinManager&&m.addinManager.registerAddinFn("34fa06be-54ed-41d5-b1d9-5abed82fab39",fn_addin);